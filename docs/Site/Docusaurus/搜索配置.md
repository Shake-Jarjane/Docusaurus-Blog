---
id: Docusaurus-æœç´¢é…ç½®
slug: /Docusaurus-æœç´¢é…ç½®
title: æœç´¢é…ç½®
date: 2023/01/20
authors: Shake
last_update:
  date: 2023/02/07
keywords: [docusaurus]
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

æœç´¢åŠŸèƒ½æ˜¯åŸºäº `algolia` æ¥è¿›è¡Œé…ç½®ï¼Œé…ç½®æ–¹å¼æœ‰ä¸¤ç§: 

1. è®© `Docsearch` æ¯å‘¨çˆ¬ä¸€æ¬¡ä½ çš„ç½‘ç«™ï¼Œå‰ææ¡ä»¶æ˜¯ä½ çš„é¡¹ç›®å¿…é¡»æ˜¯å¼€æºçš„ï¼Œå¦åˆ™è¦è¿›è¡Œæ”¶è´¹ï¼Œå¥½å¤„æ˜¯æ²¡æœ‰é¢å¤–çš„é…ç½®ï¼Œåªä¸è¿‡ç”³è¯·æ¯”è¾ƒç¹çã€‚

2. è‡ªå·±è¿è¡Œ `Docsearch` çˆ¬è™«ï¼Œæ ¹æ®è‡ªå·±å¿ƒæƒ…éšæ—¶çˆ¬å–ï¼Œä½†æ˜¯éœ€è¦è‡ªè¡Œæ³¨å†Œè´¦å·å’Œæ­å»ºçˆ¬è™«ç¯å¢ƒï¼ˆdockerï¼‰ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ç›®å‰é€‰æ‹©çš„æ–¹å¼ã€‚

:::tip ğŸ’¬
åœ¨å¼€å§‹ä»¥ä¸‹æ­¥éª¤ä¹‹å‰è¯·å…ˆé˜…è¯» **[æœç´¢|Docusaurus](https://docusaurus.io/zh-CN/docs/search)** è¿›è¡ŒåŸºæœ¬çš„é…ç½®
:::

ä¸‹é¢åªä»‹ç»æˆ‘æ‰€é‡‡ç”¨çš„é…ç½®æ–¹å¼ï¼ŒåŸæœ¬é‡‡ç”¨çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œåæ¥å› ç”³è¯·æ—¶é—´æœ‰ç‚¹ä¹…è¾¹é€‰æ‹©äº†**ç¬¬äºŒç§æ–¹æ¡ˆ**

## ä¸»åŠ¨çˆ¬å–

è¿›å…¥ Algolia DocSearch çš„[ç”³è¯·åœ°å€](https://docsearch.algolia.com/apply/)ï¼Œå¡«å†™ç›¸å…³ä¿¡æ¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç½‘ç«™è¦å¯ä»¥å…¬å¼€è®¿é—®çš„

![20230125015250](https://shake-picture.oss-cn-guangzhou.aliyuncs.com/Docusaurus/docs/Blog_Building/Docusaurus/20230125015250.png)

ç”³è¯·çš„è¿‡ç¨‹å¯èƒ½æ¯”è¾ƒéº»çƒ¦å’Œè€—æ—¶ï¼Œä½†ä»–æ˜¯å…è´¹çš„ï¼Œè€Œä¸”ä¸€åŠ³æ°¸é€¸ï¼ˆå¦‚æœä½ ä¸æƒ³æŠ˜è…¾è‡ªå·±è¿è¡Œçˆ¬è™«çš„è¯ï¼‰<br/>

ç„¶è€Œç”³è¯·ç»“æœé‚®ä»¶ï¼Œæœ€ç»ˆæ˜¯ç­‰äº†ä¸‰å››å¤©æ‰æ”¶åˆ°

![20230125015304](https://shake-picture.oss-cn-guangzhou.aliyuncs.com/Docusaurus/docs/Blog_Building/Docusaurus/20230125015304.png)

æœ¬ç€å¿ƒæ€¥ï¼Œæˆ‘åˆç”³è¯·äº†ä¸€ä¸¤æ¬¡ **ï¼ˆä¸å»ºè®®è¿™ä¹ˆåšï¼Œå› ä¸ºå®¡æ˜¯äººå·¥ä¸ªå®¡æ ¸çš„ï¼Œå®˜æ–¹çš„è¯´æ³•æ˜¯å¯èƒ½ä¼šå»¶é•¿å®¡æ ¸å‘¨æœŸï¼Œæœ€é•¿çš„å¯èƒ½ä¼šåˆ°ä¸¤å‘¨ï¼ï¼‰** <br/>
äºæ˜¯æˆ‘åˆå¯»æ‰¾åˆ°äº†æ›´å¥½ä¹Ÿæ›´é€‚åˆæˆ‘çš„æ–¹æ¡ˆï¼Œå¦‚ä¸‹ï¼š

ä¸»è¦å‚è€ƒæ•™ç¨‹çš„åšä¸»å½•åˆ¶äº†ä¸ª[è§†é¢‘æ•™ç¨‹](https://www.youtube.com/watch?v=cykGdsbe6f0)ï¼Œå¯ä»¥ç»“åˆæ–‡æ¡£ä¸€èµ·å‚è€ƒï¼Œä¸è¿‡ä½ å¾—éœ€è¦å»å¤–é¢çš„ä¸–ç•Œçœ‹çœ‹ã€‚

ä»¥ä¸‹æ­¥éª¤çš„å‰ææ˜¯å·²ç»åˆ›å»ºäº† [algolia](https://www.algolia.com/) è´¦å·ï¼Œä»“åº“ä¸­ä¹Ÿåˆ›å»ºäº† Actionï¼Œç„¶åä¸‹é¢ä¸‰ä¸ª algolia çš„ Key å€¼æ˜¯å¾…ä¼šéœ€è¦ç”¨åˆ°çš„

![20230125015640](https://shake-picture.oss-cn-guangzhou.aliyuncs.com/Docusaurus/docs/Blog_Building/Docusaurus/20230125015640.png)

ç„¶åä¸‹é¢ä¸»è¦è¯´å…¶ä¸­ä¸¤é’Ÿè§¦å‘æ¡ä»¶ï¼ŒåŒºåˆ«åœ¨äº `yml` æ–‡ä»¶çš„ `on` å­—æ®µå†…å®¹ä¸ä¸€æ ·ï¼Œå…¶ä»–ä¸€è‡´ï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©

### é…ç½®è§¦å‘æ–¹å¼

<Tabs
defaultValue="submit"
values={[
    {label: 'æäº¤ä»£ç è§¦å‘', value: 'submit'},
    {label: 'éƒ¨ç½²è§¦å‘', value: 'deployment'},
    {label: 'å®šæ—¶è§¦å‘', value: 'timer'},
]}>

<TabItem value="submit">

```
on:
  push:
    branches:
      - main
```

:::tip æç¤º
æäº¤ä»£ç è§¦å‘ç›¸å½“äºè¿˜æ²¡éƒ¨ç½²æ›´æ–°çš„å†…å®¹å°±å¼€å§‹è¿è¡Œçˆ¬è™«äº†ï¼Œå°±æ˜¯è¯´çˆ¬å–çš„æ˜¯ä¸Šä¸€æ¬¡éƒ¨ç½²æˆåŠŸçš„å†…å®¹
:::

</TabItem>

<TabItem value="deployment">

```
on:
  deployment
```

:::tip æ³¨æ„
å¦‚æœä½ çš„éƒ¨ç½²æ–¹å¼å’Œæˆ‘çš„ä¸€æ ·ï¼ˆå‚è€ƒ[**è¿™ç¯‡æ–‡ç« **](docs/../éƒ¨ç½².md)ï¼‰ï¼Œå¹¶ä¸”è§¦å‘ docsearch çš„æ–¹å¼é€‰æ‹©éƒ¨ç½²è§¦å‘çš„è¯ï¼Œåªéœ€å°†ä»¥ä¸‹ä»£ç å¤åˆ¶å¹¶æ·»åŠ åˆ° deploy.yml åº•ä¸‹å³å¯,æ³¨æ„å’Œç´§æ¥çš„ `-name` å­—æ®µå¯¹é½ï¼Œç„¶åè·³åˆ°[ä¸‹ä¸€æ­¥](#Action_secrets)
:::

```yml title="deploy.yml"
      - name: Get the content of docsearch.json as config
        id: algolia_config
        run: echo "::set-output name=config::$(cat docsearch.json | jq -r tostring)"

      - name: Run algolia/docsearch-scraper image
        env:
          ALGOLIA_APP_ID: ${{ secrets.ALGOLIA_APP_ID }}
          ALGOLIA_API_KEY: ${{ secrets.ALGOLIA_API_KEY }}
          CONFIG: ${{ steps.algolia_config.outputs.config }}
        run: |
          docker run \
            --env APPLICATION_ID=${ALGOLIA_APP_ID} \
            --env API_KEY=${ALGOLIA_API_KEY} \
            --env "CONFIG=${CONFIG}" \
            algolia/docsearch-scraper
```

</TabItem>

<TabItem value="timer">

```
on:
  schedule:
    # çº¦æ¯å¤©æ—©ä¸Š8ç‚¹è§¦å‘ï¼ˆUTCæ—¶é—´0ç‚¹ï¼‰
    - cron: '0 0 * * *'
```

</TabItem>
</Tabs>

åœ¨æ ¹ç›®å½•ä¸‹ `.github/workflows/` ä¸‹åˆ›å»º `docsearch.yml` æ–‡ä»¶

```yml {6-7} title="docsearch.yml"
# This workflow will do a clean installation of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions

name: docsearch

on:
#  The way you choose

jobs:
  algolia:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Get the content of docsearch.json as config
        id: algolia_config
        run: echo "::set-output name=config::$(cat docsearch.json | jq -r tostring)"

      - name: Run algolia/docsearch-scraper image
        env:
          ALGOLIA_APP_ID: ${{ secrets.ALGOLIA_APP_ID }}
          ALGOLIA_API_KEY: ${{ secrets.ALGOLIA_API_KEY }}
          CONFIG: ${{ steps.algolia_config.outputs.config }}
        run: |
          docker run \
            --env APPLICATION_ID=${ALGOLIA_APP_ID} \
            --env API_KEY=${ALGOLIA_API_KEY} \
            --env "CONFIG=${CONFIG}" \
            algolia/docsearch-scraper
```

##### {#Action_secrets}

ç„¶ååœ¨é¡¹ç›®ä»“åº“ï¼ˆæˆ‘çš„æ˜¯æºç ä»“åº“ï¼‰ä¸­æ–°å»ºä¸¤ä¸ª **`Action secrets`** ï¼Œè¾“å…¥ algolia çš„ç›¸å…³ **`Key`**


![20230125020800](https://shake-picture.oss-cn-guangzhou.aliyuncs.com/Docusaurus/docs/Blog_Building/Docusaurus/20230125020800.png)

### é…ç½® docsearch.json

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `docsearch.json` æ–‡ä»¶ï¼Œå¹¶å°†ä»£ç é«˜äº®çš„éƒ¨åˆ†æ›¿æ¢æˆè‡ªå·±çš„ä¿¡æ¯

```json {2-4} title="docsearch.json"
{
  "index_name": "Shake",
  "start_urls": ["https://www.shaking.site/"],
  "sitemap_urls": ["https://www.shaking.site/sitemap.xml"],
  "selectors": {
    "lvl0": {
      "selector": "(//ul[contains(@class,'menu__list')]//a[contains(@class, 'menu__link menu__link--sublist menu__link--active')]/text() | //nav[contains(@class, 'navbar')]//a[contains(@class, 'navbar__link--active')]/text())[last()]",
      "type": "xpath",
      "global": true,
      "default_value": "Documentation"
    },
    "lvl1": "header h1, article h1",
    "lvl2": "article h2",
    "lvl3": "article h3",
    "lvl4": "article h4",
    "lvl5": "article h5, article td:first-child",
    "lvl6": "article h6",
    "text": "article p, article li, article td:last-child"
  },
  "custom_settings": {
    "attributesForFaceting": [
      "type",
      "lang",
      "language",
      "version",
      "docusaurus_tag"
    ],
    "attributesToRetrieve": [
      "hierarchy",
      "content",
      "anchor",
      "url",
      "url_without_anchor",
      "type"
    ],
    "attributesToHighlight": ["hierarchy", "content"],
    "attributesToSnippet": ["content:10"],
    "camelCaseAttributes": ["hierarchy", "content"],
    "searchableAttributes": [
      "unordered(hierarchy.lvl0)",
      "unordered(hierarchy.lvl1)",
      "unordered(hierarchy.lvl2)",
      "unordered(hierarchy.lvl3)",
      "unordered(hierarchy.lvl4)",
      "unordered(hierarchy.lvl5)",
      "unordered(hierarchy.lvl6)",
      "content"
    ],
    "distinct": true,
    "attributeForDistinct": "url",
    "customRanking": [
      "desc(weight.pageRank)",
      "desc(weight.level)",
      "asc(weight.position)"
    ],
    "ranking": [
      "words",
      "filters",
      "typo",
      "attribute",
      "proximity",
      "exact",
      "custom"
    ],
    "highlightPreTag": "<span class='algolia-docsearch-suggestion--highlight'>",
    "highlightPostTag": "</span>",
    "minWordSizefor1Typo": 3,
    "minWordSizefor2Typos": 7,
    "allowTyposOnNumericTokens": false,
    "minProximity": 1,
    "ignorePlurals": true,
    "advancedSyntax": true,
    "attributeCriteriaComputedByMinProximity": true,
    "removeWordsIfNoResults": "allOptional",
    "separatorsToIndex": "_",
    "synonyms": [
      ["js", "javascript"],
      ["ts", "typescript"]
    ]
  }
}
```

### é…ç½® docusaurus.config.js

```js
module.exports = {
  themeConfig: {
    algolia: {
      appId: 'YOUR_APP_ID',          // Application ID
      apiKey: 'YOUR_SEARCH_API_KEY', // Search-Only API Key
      indexName: 'YOUR_INDEX_NAME'   // Index name
    }
  }
};
```

å®Œæˆä»¥ä¸Šæ‰€æœ‰æ­¥éª¤ä¹‹åå³å¯åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œè¿›è¡Œæœç´¢æµ‹è¯•ï¼Œåœ¨ `Brows` é‡Œæœ‰æ•°æ®è¯´æ˜å·²ç»æ­£å¸¸çˆ¬å–äº†

![20230125021458](https://shake-picture.oss-cn-guangzhou.aliyuncs.com/Docusaurus/docs/Blog_Building/Docusaurus/20230125021458.png)
<br/>

:::tip  
å¦‚æœæœ‰å…¶ä»–çš„é—®é¢˜å¯ä»¥å»é€›é€›åº•ä¸‹çš„å‚è€ƒé“¾æ¥ï¼Œè¯´ä¸å®šä¼šæœ‰å¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚
:::

## å‚è€ƒä¸è‡´è°¢

- **[æœç´¢ | Docusaurus](https://docusaurus.io/zh-CN/docs/search)**
- **[Docusaurus DocSearch æ­å»º](https://www.alanwang.site/posts/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E7%B3%BB%E5%88%97/Docusaurus-%E6%90%9C%E7%B4%A2)**
- **[docsearchplugin](https://blog.csdn.net/jiudenggushijingguo/article/details/125909267)**
- **[é€é GitHub Action è‡ªå‹•åŸ·è¡Œ DocSearch çš„çˆ¬èŸ²](https://ouch1978.github.io/docs/docusaurus/configuration/automatically-run-docsearch-scraper-from-github-action)**
- **[åœ¨ Docusaurus ä¸­ä½¿ç”¨ Algolia å¯¦ä½œæœå°‹åŠŸèƒ½](https://weiyun0912.github.io/Wei-Docusaurus/docs/Docusaurus/Algolia/)**
